<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>remote_robotics: SerialCom.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_f93f1e293c490d30b7c4b0f1372e5ecd.html">pololu</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SerialCom.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SerialCom_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//============================================================================</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Name        : SerialCom.cpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Author      : Willi Penner</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// Description : SerialCom source file. It contains the definition of the</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//               functions of the SerialCom class.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//============================================================================</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SerialCom_8hpp.html">pololu/SerialCom.hpp</a>&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">    #include &lt;windows.h&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">        #include &lt;fcntl.h&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">        #include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">        #include &lt;stdint.h&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">        #include &lt;termios.h&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">        #include &lt;stdbool.h&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                 SerialComWIN32(<span class="keyword">const</span> <span class="keywordtype">char</span>* portName=<span class="stringliteral">&quot;COM0&quot;</span>,</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> baudRate=9600){</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                        portName_ = portName;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                        baudRate_ = baudRate;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                        port_ = NULL;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                 }</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                 <span class="keywordtype">void</span> initSerialCom (<span class="keyword">const</span> <span class="keywordtype">char</span>* portName=<span class="stringliteral">&quot;COM0&quot;</span>,</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> baudRate=9600){</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                        <span class="keywordflow">try</span>{</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                                <span class="keywordflow">if</span>(isSerialComOpen_){</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                        CloseHandle(port_);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                        isSerialComOpen_ = <span class="keyword">false</span>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                };</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                portName_ = portName;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                baudRate_ = baudRate;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                        }<span class="keywordflow">catch</span>(<a class="code" href="classIException.html">IException</a> *e){</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;(caught IException error :: initSerialCom::&quot;</span>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                msg += string(<span class="stringliteral">&quot;throw ExceptionSerialCom: error while closing an open serial connection:: &quot;</span>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                                msg += e-&gt;<a class="code" href="classIException.html#a41d25da6a3bafe606951879e85e793a0">getMsg</a>() + string(<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                        }<span class="keywordflow">catch</span>(<span class="keywordtype">string</span> m){</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;(caught string error :: initSerialCom::&quot;</span>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                msg += string(<span class="stringliteral">&quot;throw ExceptionSerialCom: error while closing an open serial connection:: &quot;</span>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                                msg += m + string(<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                        }<span class="keywordflow">catch</span>(...){</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;(caught unknown error :: initSerialCom::&quot;</span>);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                msg += string(<span class="stringliteral">&quot;throw ExceptionSerialCom: error while closing an open serial connection:: &quot;</span>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                                msg += string(<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                        }</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                 }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                 <span class="keywordtype">bool</span> openSerialCom (){</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                        <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                        <span class="keywordflow">try</span>{</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                                port_ = open(portName_, O_RDWR | O_NOCTTY); <span class="comment">//you have to set the permission for the /dev/ttyACM0</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                <span class="keywordflow">if</span> (port_ == -1){</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                                        <span class="keywordtype">string</span> msg = string(<span class="stringliteral">&quot;openSerialCom: LINUX Failed to open port &#39;&quot;</span>) + string(portName_) + string(<span class="stringliteral">&quot;&#39;.&quot;</span>);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                                }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                        }<span class="keywordflow">catch</span>(...){</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;openSerialCom: LINUX unknown Error while open serial port &#39;&quot;</span>);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                msg += string(portName_) + string(<span class="stringliteral">&quot;&#39;.&quot;</span>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                        }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                        success = tcflush(port_, TCIOFLUSH);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                        <span class="keywordflow">if</span> (success){</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                                <span class="keywordflow">throw</span> std::string(<span class="stringliteral">&quot;SerialCom::openSerialCom: Failed to flush file buffer.\n&quot;</span>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                close(port_);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                        }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                        <span class="comment">// Get the current configuration of the serial port.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                        <span class="keyword">struct </span>termios options;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                        success = tcgetattr(port_, &amp;options);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                        <span class="keywordflow">if</span> (success){</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                                <span class="keywordflow">throw</span> std::string(<span class="stringliteral">&quot;SerialCom::openSerialCom: Failed to get serial settings.\n&quot;</span>);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                close(port_);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                        }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                        <span class="comment">// Turn off any options that might interfere with our ability to send and</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                        <span class="comment">// receive raw binary bytes.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                        options.c_iflag &amp;= ~(INLCR | IGNCR | ICRNL | IXON | IXOFF);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                        options.c_oflag &amp;= ~(ONLCR | OCRNL);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        options.c_lflag &amp;= ~(ECHO | ECHONL | ICANON | ISIG | IEXTEN);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                        <span class="comment">// Set up timeouts: Calls to read() will return as soon as there is</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                        <span class="comment">// at least one byte available or when 100 ms has passed.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                        options.c_cc[VTIME] = 1;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                        options.c_cc[VMIN] = 0;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        <span class="comment">// This code only supports certain standard baud rates. Supporting</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                        <span class="comment">// non-standard baud rates should be possible but takes more work.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                        cfsetospeed(&amp;options, B9600);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                        cfsetispeed(&amp;options, cfgetospeed(&amp;options));</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                        success = tcsetattr(port_, TCSANOW, &amp;options);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                        <span class="keywordflow">if</span> (success){</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                <span class="keywordflow">throw</span> std::string(<span class="stringliteral">&quot;SerialCom::openSerialCom: Failed to set serial settings.\n&quot;</span>);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                close(port_);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                 }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                 <span class="keywordtype">bool</span> closeSerialCom(){</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                         <span class="keywordflow">if</span> (CloseHandle(port_) == 0){</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                 <span class="keywordflow">throw</span> std::string(<span class="stringliteral">&quot;SerialCom::closeSerialCom: Failed to close port.\n&quot;</span>);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                 <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                         }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                 }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                 <span class="keywordtype">bool</span> writeSerialCom(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> command[],</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sizeCommand,</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *response,</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sizeResponse){</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                        <span class="keywordflow">if</span> ((sizeCommand != 1) &amp;&amp; (sizeCommand != 2) &amp;&amp; (sizeCommand != 4)){</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                <span class="keywordflow">throw</span> std::string(<span class="stringliteral">&quot;SerialCom::writeSerialCom: wrong parameter sizeCommand, allowed parameter 1,2 or 4.&quot;</span>);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                DWORD bytesTrasfered; <span class="comment">//Is given to the write or read command as a pointer. After executing the WriteFile or ReadFile, bytesTranfered contains the number of bytes transmitted or received.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="keywordtype">bool</span> success = 0;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                <span class="comment">//** Sending the command to the controller via port_. */</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                success = WriteFile(port_, cmd, sizeCmd, &amp;bytesTrasfered, NULL);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                <span class="keywordflow">if</span> (!success){</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                        <span class="keywordflow">throw</span> std::string(<span class="stringliteral">&quot;SerialCom::writeSerialCom: Failed to write to port.&quot;</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="comment">//** Check whether data needs to be read. */</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <span class="keywordflow">if</span> (sizeRes &gt; 0){</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        success = ReadFile(port_, (<span class="keywordtype">void</span> *)res, sizeRes, &amp;bytesTrasfered, NULL);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        <span class="keywordflow">return</span> 1; <span class="comment">//No need to read data. Confirmation of the successful writing of the data.</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                <span class="keywordflow">if</span> (!success){</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                        <span class="keywordflow">throw</span> std::string(<span class="stringliteral">&quot;SerialCom::writeSerialCom: Failed to read from port.&quot;</span>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">//Confirmation that data was written and read data were saved in the response array.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                 }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                 HANDLE getPort(){</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                         <span class="keywordflow">return</span> port_;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                 }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="classSerialComLINUX.html#aa0d54938fe48039dc18785ca6d9538ff">  176</a></span>&#160;        <a class="code" href="classSerialComLINUX.html#aa0d54938fe48039dc18785ca6d9538ff">SerialComLINUX::SerialComLINUX</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* portName,</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                                                        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> baudRate){</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <a class="code" href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">isSerialComOpen_</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                <a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a> = portName;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                <a class="code" href="classSerialComBase.html#abd684e4f62c32ce0a888234d6c0e560a">baudRate_</a> = baudRate;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                <a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a> = 0;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="classSerialComLINUX.html#a3969e919017724bf151ca433a9c4c52c">  185</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classSerialComLINUX.html#a3969e919017724bf151ca433a9c4c52c">SerialComLINUX::initSerialCom</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* portName,</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                                                                <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> baudRate){</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                <span class="keywordflow">try</span>{</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">isSerialComOpen_</a>){</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;initSerialCom:: port is already open, close port first before initialization.&quot;</span>);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                        };</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                        <a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a> = portName;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        <a class="code" href="classSerialComBase.html#abd684e4f62c32ce0a888234d6c0e560a">baudRate_</a> = baudRate;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                }<span class="keywordflow">catch</span>(<a class="code" href="classIException.html">IException</a> *e){</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;(caught IException error :: initSerialCom::&quot;</span>);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                        msg += string(<span class="stringliteral">&quot;throw ExceptionSerialCom: error while closing an open serial connection:: &quot;</span>);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                        msg += e-&gt;<a class="code" href="classIException.html#a41d25da6a3bafe606951879e85e793a0">getMsg</a>() + string(<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                }<span class="keywordflow">catch</span>(<span class="keywordtype">string</span> m){</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;(caught string error :: initSerialCom::&quot;</span>);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                        msg += string(<span class="stringliteral">&quot;throw ExceptionSerialCom: error while closing an open serial connection:: &quot;</span>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                        msg += m + string(<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                }<span class="keywordflow">catch</span>(...){</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;(caught unknown error :: initSerialCom::&quot;</span>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        msg += string(<span class="stringliteral">&quot;throw ExceptionSerialCom: error while closing an open serial connection:: &quot;</span>);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                        msg += string(<span class="stringliteral">&quot;)&quot;</span>);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        };</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="classSerialComLINUX.html#a5e1293331b119354ddac6f1c6e104252">  215</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classSerialComLINUX.html#a5e1293331b119354ddac6f1c6e104252">SerialComLINUX::openSerialCom</a>(){</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <span class="keywordtype">int</span> success = -1;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">isSerialComOpen_</a>){</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;openSerialCom:: port is already open, close port first before open it.&quot;</span>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a> = open(<a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a>, O_RDWR | O_NOCTTY); <span class="comment">//success requires  permission</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a> == -1){</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;openSerialCom: LINUX cannot open port, check permission of &#39;&quot;</span>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                        msg += string(<a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a>) + string(<span class="stringliteral">&quot;&#39;.&quot;</span>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                success = tcflush(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>, TCIOFLUSH); <span class="comment">// function delivers value 0 on success, -1 otherwise</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordflow">if</span> (success != 0){</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                        close(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;SerialCom::openSerialCom: Failed to flush file buffer. Close port again.&quot;</span>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="comment">// Get the current configuration of the serial port.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <span class="keyword">struct </span>termios options;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                success = tcgetattr(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>, &amp;options);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">if</span> (success != 0){</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                        close(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;SerialCom::openSerialCom: Failed to read serial settings.&quot;</span>);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                        msg += string(<a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a>) + string(<span class="stringliteral">&quot; setting cannot be read. Port closed again.&quot;</span>);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="comment">// Turn off any options that might interfere with our ability to send and</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="comment">// receive raw binary bytes.</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                options.c_iflag &amp;= ~(INLCR | IGNCR | ICRNL | IXON | IXOFF);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                options.c_oflag &amp;= ~(ONLCR | OCRNL);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                options.c_lflag &amp;= ~(ECHO | ECHONL | ICANON | ISIG | IEXTEN);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="comment">// Set up timeouts: Calls to read() will return as soon as there is</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="comment">// at least one byte available or when 100 ms has passed.</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                options.c_cc[VTIME] = 1;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                options.c_cc[VMIN] = 0;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                <span class="comment">// This code only supports certain standard baud rates. Supporting</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                <span class="comment">// non-standard baud rates should be possible but takes more work.</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                cfsetospeed(&amp;options, B9600);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                cfsetispeed(&amp;options, cfgetospeed(&amp;options));</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                success = tcsetattr(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>, TCSANOW, &amp;options);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="keywordflow">if</span> (success != 0){</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        close(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;SerialCom::openSerialCom: Failed to set serial settings.&quot;</span>);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        msg += string(<a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a>) + string(<span class="stringliteral">&quot; parameters cannot be written. Port closed again.&quot;</span>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <a class="code" href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">isSerialComOpen_</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        };</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="classSerialComLINUX.html#aeef058fc40479698cdf94efadb9ca457">  275</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classSerialComLINUX.html#aeef058fc40479698cdf94efadb9ca457">SerialComLINUX::closeSerialCom</a>(){</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">isSerialComOpen_</a>){</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                        <span class="keywordflow">try</span>{</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                                close(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                        }<span class="keywordflow">catch</span>(...){</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;closeSerialCom:: error while trying to close port.&quot;</span>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                msg += string(<span class="stringliteral">&quot;state of port is now undefined.&quot;</span>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                        }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <a class="code" href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">isSerialComOpen_</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        };</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="classSerialComLINUX.html#aeb8710a98c8c7910d1751d509c9074b2">  289</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classSerialComLINUX.html#aeb8710a98c8c7910d1751d509c9074b2">SerialComLINUX::writeSerialCom</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmd[],</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                                                                <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sizeCmd,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                                                                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *res,</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                                                                <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sizeRes){</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                <span class="keywordflow">if</span>(!<a class="code" href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">isSerialComOpen_</a>){</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;writeSerialCom:: port is not open yet, open port first before write/reading.&quot;</span>);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="comment">// check parameter values of this function call</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="keywordflow">if</span> ((sizeCmd != 1) &amp;&amp; (sizeCmd != 2) &amp;&amp; (sizeCmd != 4)){</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;SerialCom::writeSerialCom: wrong parameter sizeCommand,&quot;</span>);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                        msg += string(<span class="stringliteral">&quot;allowed parameter values are either 1,2 or 4.&quot;</span>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                <span class="keywordflow">if</span> ((sizeRes != 0) &amp;&amp; (sizeRes != 1) &amp;&amp; (sizeRes != 2)){</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;SerialCom::writeSerialCom: wrong parameter sizeRes,&quot;</span>);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                        msg += string(<span class="stringliteral">&quot;allowed parameter values are either 0,1 or 2.&quot;</span>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                <span class="comment">//** Sending the command to the controller via port_. */</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                <span class="keywordflow">if</span>(write(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>, cmd, sizeCmd) == -1){</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                        <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;SerialCom::writeSerialCom: Failed to write to port &#39;&quot;</span>);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                        msg += string(<a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a>) + string(<span class="stringliteral">&quot;&#39;.&quot;</span>);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                <span class="comment">//** Check whether data needs to be read. */</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                <span class="keywordflow">if</span> (sizeRes &gt; 0){</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                        <span class="keywordtype">unsigned</span> counter = 0;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                        <span class="keywordtype">unsigned</span> maxCounterValue = 20; <span class="comment">// a kind of timeout</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> dataRecv = 0;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> dataRecvTotal = 0;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                        <span class="keywordflow">do</span>{ <span class="comment">// try to read data from port</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                counter++;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                dataRecv = read(<a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>, (<span class="keywordtype">void</span> *)res, sizeRes);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                <span class="keywordflow">if</span>(dataRecv &gt; 0){</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                        dataRecvTotal += dataRecv;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                                <span class="keywordflow">if</span>(maxCounterValue == counter) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                        }<span class="keywordflow">while</span>(dataRecv != sizeRes);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                        <span class="keywordflow">if</span>(dataRecv != sizeRes){</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                stringstream ss;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                                ss &lt;&lt; <span class="stringliteral">&quot;SerialCom::writeSerialCom: Failed while reading from port &#39;&quot;</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                ss &lt;&lt; <a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a> &lt;&lt; <span class="stringliteral">&quot;&#39;.&quot;</span>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                ss &lt;&lt; <span class="stringliteral">&quot;size of data (byte) received = &quot;</span> &lt;&lt; dataRecvTotal &lt;&lt; <span class="stringliteral">&quot; unequal to expected&quot;</span>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                                ss &lt;&lt; <span class="stringliteral">&quot; data size to be received = &quot;</span> &lt;&lt; sizeRes &lt;&lt; <span class="stringliteral">&quot;. &quot;</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(ss.str());</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                        }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                };</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        };</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="classSerialComLINUX.html#ae4de97a150d5e74e6fe985f02ac1685e">  346</a></span>&#160;        <span class="keywordtype">int</span>  <a class="code" href="classSerialComLINUX.html#ae4de97a150d5e74e6fe985f02ac1685e">SerialComLINUX::getPort</a>(){</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">isSerialComOpen_</a>){</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">port_</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                };</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordtype">string</span> msg(<span class="stringliteral">&quot;SerialCom::getPort: Cannot provide port number &#39;&quot;</span>);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                msg += string(<a class="code" href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">portName_</a>) + string(<span class="stringliteral">&quot;&#39; is not open yet.&quot;</span>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                msg += string (<span class="stringliteral">&quot;Open port first before calling this methode.&quot;</span>);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classExceptionSerialCom.html">ExceptionSerialCom</a>(msg);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        };</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor">#endif // LINUX: end definition of methods</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="ttc" id="classSerialComBase_html_abd684e4f62c32ce0a888234d6c0e560a"><div class="ttname"><a href="classSerialComBase.html#abd684e4f62c32ce0a888234d6c0e560a">SerialComBase::baudRate_</a></div><div class="ttdeci">unsigned short baudRate_</div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8hpp_source.html#l00097">SerialCom.hpp:97</a></div></div>
<div class="ttc" id="classSerialComLINUX_html_aeef058fc40479698cdf94efadb9ca457"><div class="ttname"><a href="classSerialComLINUX.html#aeef058fc40479698cdf94efadb9ca457">SerialComLINUX::closeSerialCom</a></div><div class="ttdeci">bool closeSerialCom()</div><div class="ttdoc">Closes a serial connection. If an error occurs an exception (IException) is thrown. </div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8cpp_source.html#l00275">SerialCom.cpp:275</a></div></div>
<div class="ttc" id="classSerialComBase_html_a1cfe6451c55ec08f7cf7670d52d05241"><div class="ttname"><a href="classSerialComBase.html#a1cfe6451c55ec08f7cf7670d52d05241">SerialComBase::isSerialComOpen_</a></div><div class="ttdeci">bool isSerialComOpen_</div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8hpp_source.html#l00095">SerialCom.hpp:95</a></div></div>
<div class="ttc" id="classSerialComLINUX_html_ae4de97a150d5e74e6fe985f02ac1685e"><div class="ttname"><a href="classSerialComLINUX.html#ae4de97a150d5e74e6fe985f02ac1685e">SerialComLINUX::getPort</a></div><div class="ttdeci">int getPort()</div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8cpp_source.html#l00346">SerialCom.cpp:346</a></div></div>
<div class="ttc" id="classSerialComLINUX_html_a0462255871037cb46c14370c62e23ff8"><div class="ttname"><a href="classSerialComLINUX.html#a0462255871037cb46c14370c62e23ff8">SerialComLINUX::port_</a></div><div class="ttdeci">int port_</div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8hpp_source.html#l00123">SerialCom.hpp:123</a></div></div>
<div class="ttc" id="classSerialComLINUX_html_aa0d54938fe48039dc18785ca6d9538ff"><div class="ttname"><a href="classSerialComLINUX.html#aa0d54938fe48039dc18785ca6d9538ff">SerialComLINUX::SerialComLINUX</a></div><div class="ttdeci">SerialComLINUX(const char *portName=&quot;/dev/ttyACM0&quot;, unsigned short baudRate=9600)</div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8cpp_source.html#l00176">SerialCom.cpp:176</a></div></div>
<div class="ttc" id="classSerialComLINUX_html_aeb8710a98c8c7910d1751d509c9074b2"><div class="ttname"><a href="classSerialComLINUX.html#aeb8710a98c8c7910d1751d509c9074b2">SerialComLINUX::writeSerialCom</a></div><div class="ttdeci">bool writeSerialCom(unsigned char command[], unsigned short sizeCommand, unsigned char *response, unsigned short sizeResponse)</div><div class="ttdoc">This method is used to write commands to and read response from the controller via the open serial co...</div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8cpp_source.html#l00289">SerialCom.cpp:289</a></div></div>
<div class="ttc" id="classIException_html_a41d25da6a3bafe606951879e85e793a0"><div class="ttname"><a href="classIException.html#a41d25da6a3bafe606951879e85e793a0">IException::getMsg</a></div><div class="ttdeci">virtual string getMsg()=0</div></div>
<div class="ttc" id="classExceptionSerialCom_html"><div class="ttname"><a href="classExceptionSerialCom.html">ExceptionSerialCom</a></div><div class="ttdoc">Exception class for class SerialCom. </div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8hpp_source.html#l00174">SerialCom.hpp:174</a></div></div>
<div class="ttc" id="classSerialComLINUX_html_a5e1293331b119354ddac6f1c6e104252"><div class="ttname"><a href="classSerialComLINUX.html#a5e1293331b119354ddac6f1c6e104252">SerialComLINUX::openSerialCom</a></div><div class="ttdeci">bool openSerialCom()</div><div class="ttdoc">Opens the serial com defined by the initSerialCom(...) method or the constructor parameter. If the port can be successfully be opened the method retuns true. If an error occurs an exception (IException) is thrown. If the serial com is already open an exception (IException) is thrown. </div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8cpp_source.html#l00215">SerialCom.cpp:215</a></div></div>
<div class="ttc" id="classSerialComLINUX_html_a3969e919017724bf151ca433a9c4c52c"><div class="ttname"><a href="classSerialComLINUX.html#a3969e919017724bf151ca433a9c4c52c">SerialComLINUX::initSerialCom</a></div><div class="ttdeci">void initSerialCom(const char *portName=&quot;/dev/ttyACM0&quot;, unsigned short baudRate=9600)</div><div class="ttdoc">Used to initiate the SerialCom object with port name and baud rate. The function puts the object in t...</div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8cpp_source.html#l00185">SerialCom.cpp:185</a></div></div>
<div class="ttc" id="SerialCom_8hpp_html"><div class="ttname"><a href="SerialCom_8hpp.html">SerialCom.hpp</a></div></div>
<div class="ttc" id="classSerialComBase_html_a75dc0d0972d930e7f852892915647603"><div class="ttname"><a href="classSerialComBase.html#a75dc0d0972d930e7f852892915647603">SerialComBase::portName_</a></div><div class="ttdeci">const char * portName_</div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8hpp_source.html#l00096">SerialCom.hpp:96</a></div></div>
<div class="ttc" id="classIException_html"><div class="ttname"><a href="classIException.html">IException</a></div><div class="ttdoc">Interface for exceptions to be overwritten by the derived classes. </div><div class="ttdef"><b>Definition:</b> <a href="SerialCom_8hpp_source.html#l00154">SerialCom.hpp:154</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/remote_robotics">remote_robotics</a><br />
Author(s): </br />
<small>autogenerated on Sun Apr 28 2024 16:04:02</small>
</div>
</body>
</html>
